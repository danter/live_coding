<html>
  <head>
    <script src="ace-editor/ace.js"></script>
    <style>
      .editor {
        height: 300px;
        width: 600px;
      }

      .view {
        width: 600px;
        height: 300px;
        background-color: purple;
        float: right;
      }

      .container {
        width: 1250px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="view js-view"></div>
      <div class="editor js-editor">/* jshint asi:true */
view = document.getElementsByClassName("js-view")[0]
view.style.height = 300

main = function() {
  // Always check this in the main loop to stop running old versions of your code!
  if(codeHasChanged()) { return; }

  view.style.height = parseInt(view.style.height) - 1
}

setInterval(main, 100)</div>
    </div>

    <script type="text/javascript">
      editorDiv = document.getElementsByClassName("js-editor")[0]
      editor = ace.edit(editorDiv)
      editor.setTheme("ace/theme/github")

      // Settings for javascript editing
      editor.setOption("tabSize", 4)
      editor.setOption("useSoftTabs", true)
      editor.session.setMode("ace/mode/javascript")

      // Hide the 80 chars line. No strong reason, mostly because
      // the size of the window is probably a more practical limit for now.
      editor.setShowPrintMargin(false)

      if(window.location.href.indexOf("vim") != -1) {
        editor.setKeyboardHandler("ace/keyboard/vim")
      }

      // Have no looked deeply at this:
      // "Automatically scrolling cursor into view after selection change this will be disabled in the next version set editor.$blockScrolling = Infinity to disable this message"
      editor.$blockScrolling = Infinity

      savedCode = localStorage.getItem("code")
      if(savedCode) {
        console.log("LiveCoding: Loading previously saved code from local storage")
        editor.setValue(savedCode)
        editor.clearSelection()
      }

      editor.gotoLine(1)
      editor.focus()

      runCode = function() {
        code = editor.getValue()

        script = document.createElement("script")
        script.type = "text/javascript"

	localStorage.setItem("code", code)

        window.liveCodeVersion += 1

        script.innerHTML =
          "(function() {" +
	    // Add function that can be used to check if the code is outdated and should stop running.
            "function codeHasChanged() { return " + window.liveCodeVersion + " != window.liveCodeVersion };" +

            // Load the new version of the code.
            code +

            // Show what version of the code is running now.
            "\nconsole.log('LiveCoding: Code version ' + window.liveCodeVersion + ' loaded successfully!')" +
          "})();"

        document.body.appendChild(script)
      }

      window.liveCodeVersion = 1
      editor.on("change", runCode);
      runCode()
    </script>
  </body>
</html>
